@model websitebenhvien.Models.EnitityVM.PostactivityVM
@{
    ViewData["Title"] = Model.Title;
    ViewData["Image"] = !string.IsNullOrEmpty(Model.Thumbnail) ? "/Uploads/" + Model.Thumbnail : "/Images/Logo-rm.png";
    ViewData["description"] = Model.Descriptionshort;
    ViewData["keywords"] = Model.Keyword;
    ViewData["Schema"] = Model.SchemaMakup;
}

<div class="container mt-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-transparent px-0">
            <li class="breadcrumb-item">
                <a href="/" class="text-decoration-none">Trang chủ</a>
            </li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index")" class="text-decoration-none">Hoạt động</a>
            </li>
            @if (!string.IsNullOrEmpty(Model.CategoryName))
            {
                <li class="breadcrumb-item">
                    <a href="#" onclick="history.back()" class="text-decoration-none">@Model.CategoryName</a>
                </li>
            }
            <li class="breadcrumb-item active" aria-current="page">@Model.Title</li>
        </ol>
    </nav>

    <div class="row mt-4">
        <!-- Sidebar bên trái -->
        <aside class="col-lg-3 mb-4">
            <div class="card border-0 shadow-sm rounded-3">
                <div class="card-header bg-gradient text-white d-flex align-items-center" 
                     style="background: linear-gradient(135deg, #007bff, #0056b3);">
                    <i class="fas fa-th-large me-2 text-danger fw-bold"></i>
                    <h6 class="mb-0 text-uppercase text-danger fw-bold">Danh mục hoạt động</h6>
                </div>
                <div class="list-group list-group-flush">
                    @await Component.InvokeAsync("Danhmuchoatdong")
                </div>
            </div>
        </aside>

        <!-- Nội dung chính -->
        <div class="col-lg-9">
            <article class="post-content bg-white p-4 rounded-3 shadow-sm mb-4">
                <h1 class="post-title fw-bold mb-3">@Model.Title</h1>

                <div class="post-meta mb-4 d-flex align-items-center text-muted small">
                    <i class="far fa-calendar-alt me-2 text-danger"></i>
                    <span>@Model.Createat.ToString("dd/MM/yyyy")</span>
                    @if (!string.IsNullOrEmpty(Model.CategoryName))
                    {
                        <span class="mx-2">•</span>
                        <i class="fas fa-tag me-1 text-danger"></i>
                        <span>@Model.CategoryName</span>
                    }
                </div>

                <div class="post-body" id="post-body">
                    @Html.Raw(Model.Description)
                </div>
            </article>

            <!-- Nút chia sẻ -->
            <div class="share-buttons mb-4 bg-white p-3 rounded-3 shadow-sm text-center">
                <h6 class="mb-3">Chia sẻ bài viết</h6>
                <a onclick="shareToFacebook()" class="btn btn-primary me-2">
                    <i class="fab fa-facebook-f me-1"></i>Facebook
                </a>
                <a onclick="shareToTwitter()" class="btn btn-info me-2">
                    <i class="fab fa-twitter me-1"></i>Twitter
                </a>
                <a href="#" class="btn btn-danger">
                    <i class="fab fa-pinterest me-1"></i>Pinterest
                </a>
            </div>

           
           
        </div>
    </div>
</div>

@section Styles
{
    <style>
        .hover-bg:hover {
            background-color: #f8f9fa;
            color: #007bff !important;
        }
        .post-body img, 
        .post-body table, 
        .post-body input[type="image"] {
            max-width: 100%;
            height: auto;
        }
        .post-body table {
            display: block;
            overflow-x: auto;
        }
    </style>
}

@section Scripts{
    <script>
        $(document).ready(function(){
            GetActivityByCategory();
            GetActivityById();
        });

        function shareToFacebook() {
            var currentUrl = window.location.href;
            var facebookShareUrl = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(currentUrl);
            window.open(facebookShareUrl, '_blank', 'width=600,height=400');
        }

        function shareToTwitter() {
            var currentUrl = window.location.href;
            var twitterShareUrl = 'https://twitter.com/intent/tweet?url=' + encodeURIComponent(currentUrl) + '&text=' + encodeURIComponent('@Model.Title');
            window.open(twitterShareUrl, '_blank', 'width=600,height=400');
        }

        function GetActivityById() {
            $('#post-body').html('@Html.Raw(Model.Description)').css({
                'font-size': '14px',
                'padding': '10px', 
                'word-wrap': 'break-word',
                'max-width': '100%'
            }).find('img, table,input[type="image"]').css({
                'max-width': '100%',
                'height': 'auto',
                'object-fit': 'contain'
            });

            $('#post-body table').css({
                'display': 'block',
                'overflow-x': 'auto',
                'width': '100%'
            }).find('td').css({
                'min-width': '120px',
                'white-space': 'nowrap'
            });
        }

        function GetActivityByCategory(){
            var currentUrl = window.location.pathname;
            var segments = currentUrl.split('/');
            var alias_url = "/hoat-dong/chi-tiet/" + segments[segments.length - 1];
            
            $.ajax({
                url: "/Activity/GetActivityByCategory", 
                type: "POST",
                data: { alias_url: alias_url },
                success: function(response){
                   if(response.status){
                        var html = '<div id="relatedActivityCarousel" class="carousel slide" data-bs-ride="carousel">';
                        html += '<div class="carousel-inner">';
                        
                        console.log(response.data);
                        
                        // Group activities into sets of 3
                        for(var i = 0; i < response.data.length; i += 3) {
                            var isActive = i === 0 ? 'active' : '';
                            html += `<div class="carousel-item ${isActive}"><div class="row">`;
                            
                            // Add up to 3 activities per slide
                            for(var j = i; j < Math.min(i + 3, response.data.length); j++) {
                                var item = response.data[j];
                                var activityDate = new Date(item.createat).toLocaleDateString();
                                var today = new Date().toLocaleDateString();
                                var isNew = activityDate === today;
                                
                                html += `
                                    <div class="col-md-4">
                                        <div class="featured-post-item mb-4 bg-white rounded-3 shadow-hover" 
                                             style="transition: all 0.3s ease;">
                                            <a href="${item.alias_url}" class="text-decoration-none">
                                                <div class="position-relative">
                                                    <img src="/Uploads/${item.thumbnail}" 
                                                         class="img-fluid w-100 rounded-top" 
                                                         alt="${item.title}"
                                                         style="height: 200px; object-fit: cover;">
                                                    ${isNew ? '<span class="badge bg-danger position-absolute top-0 end-0 m-2">Mới</span>' : ''}
                                                </div>
                                                <div class="p-3" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                    <h6 class="text-dark mb-2 fw-bold" 
                                                        style="display: -webkit-box;
                                                               -webkit-line-clamp: 2;
                                                               -webkit-box-orient: vertical;
                                                               overflow: hidden;
                                                               line-height: 1.5;
                                                               height: 3em;
                                                               color: #2c3e50;">
                                                        ${item.title}
                                                    </h6>
                                                    <div class="d-flex align-items-center">
                                                        <i class="far fa-calendar-alt text-danger me-2"></i>
                                                        <span class="text-muted small" style="color: #6c757d !important;">${item.createat.split('T')[0]}</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                `;
                            }
                            
                            html += '</div></div>';
                        }
                        
                        html += '</div>';
                        
                        // Add carousel controls
                        html += `
                            <button class="carousel-control-prev" type="button" data-bs-target="#relatedActivityCarousel" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#relatedActivityCarousel" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        `;
                        
                        html += '</div>';

                        $('#activity-category-news').html(html);

                        // Add hover effects via CSS
                        $("<style>")
                            .text(`
                                .shadow-hover {
                                    border: 1px solid #e0e0e0;
                                    background: linear-gradient(135deg, #ffffff, #f8f9fa);
                                }
                                .shadow-hover:hover {
                                    transform: translateY(-5px);
                                    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
                                    border-color: #007bff;
                                }
                                .featured-post-item:hover h6 {
                                    color: #007bff !important;
                                    text-shadow: 0 0 1px rgba(0,123,255,0.1);
                                }
                                .featured-post-item img {
                                    transition: all 0.4s ease;
                                }
                                .featured-post-item:hover img {
                                    transform: scale(1.05);
                                    filter: brightness(1.05);
                                }
                                .badge {
                                    background: linear-gradient(45deg, #dc3545, #ff4d5a) !important;
                                    box-shadow: 0 2px 4px rgba(220,53,69,0.3);
                                }
                                .featured-post-item {
                                    border-radius: 10px;
                                    overflow: hidden;
                                }
                                .carousel-control-prev,
                                .carousel-control-next {
                                    width: 40px;
                                    height: 40px;
                                    top: 50%;
                                    transform: translateY(-50%);
                                    background: rgba(0,0,0,0.5);
                                    border-radius: 50%;
                                    margin: 0 10px;
                                }
                                .carousel-control-prev:hover,
                                .carousel-control-next:hover {
                                    background: rgba(0,0,0,0.7);
                                }
                                .carousel-control-prev-icon,
                                .carousel-control-next-icon {
                                    width: 20px;
                                    height: 20px;
                                }
                            `)
                            .appendTo("head");
                   }
                }
            });
        }
    </script>
}
